{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "FirefliesTranscriptOutput",
  "description": "Structured output from LLM processing of Fireflies transcripts",
  "type": "object",
  "required": ["call", "my_tasks", "client_tasks"],
  "properties": {
    "call": {
      "type": "object",
      "description": "Call summary record for the calls table",
      "required": ["fireflies_id", "title", "call_date", "summary"],
      "properties": {
        "fireflies_id": {
          "type": "string",
          "description": "Unique Fireflies transcript ID"
        },
        "title": {
          "type": "string",
          "description": "Meeting title"
        },
        "call_date": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 datetime of the call"
        },
        "duration_minutes": {
          "type": "integer",
          "minimum": 0,
          "description": "Call duration in minutes"
        },
        "transcript_url": {
          "type": "string",
          "format": "uri",
          "description": "URL to Fireflies transcript"
        },
        "meeting_link": {
          "type": ["string", "null"],
          "description": "Original meeting link (Zoom, Meet, etc.)"
        },
        "participants": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Array of participant email addresses"
        },
        "speakers": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Array of speaker names from transcript"
        },
        "summary": {
          "type": "string",
          "description": "2-3 sentence summary of the call"
        },
        "action_items": {
          "type": "string",
          "description": "Markdown-formatted action items grouped by person"
        },
        "keywords": {
          "type": "array",
          "items": { "type": "string" },
          "minItems": 3,
          "maxItems": 6,
          "description": "Topic keywords from the call"
        },
        "overview": {
          "type": "string",
          "description": "Bullet point overview with emoji"
        }
      }
    },
    "my_tasks": {
      "type": "array",
      "description": "Tasks assigned to Ben Reeder",
      "items": {
        "type": "object",
        "required": ["idempotency_key", "title", "priority", "source_type", "source_id"],
        "properties": {
          "idempotency_key": {
            "type": "string",
            "pattern": "^.+_task_\\d+$",
            "description": "Unique key: {fireflies_id}_task_{index}"
          },
          "title": {
            "type": "string",
            "minLength": 5,
            "maxLength": 200,
            "description": "Clear, actionable task title"
          },
          "description": {
            "type": ["string", "null"],
            "description": "Additional context from the call"
          },
          "priority": {
            "type": "string",
            "enum": ["P0", "P1", "P2", "P3"],
            "description": "Task priority level"
          },
          "due_date": {
            "type": ["string", "null"],
            "format": "date",
            "description": "Due date in YYYY-MM-DD format"
          },
          "due_time": {
            "type": ["string", "null"],
            "pattern": "^([01]?[0-9]|2[0-3]):[0-5][0-9]$",
            "description": "Due time in HH:MM format"
          },
          "timebox_bucket": {
            "type": "string",
            "enum": ["MORNING", "AFTERNOON", "EVENING", "NONE"],
            "default": "NONE",
            "description": "When during the day to work on this"
          },
          "estimated_minutes": {
            "type": ["integer", "null"],
            "minimum": 5,
            "maximum": 480,
            "description": "Estimated time to complete in minutes"
          },
          "tags": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Relevant tags for categorization"
          },
          "labels": {
            "type": "array",
            "items": { "type": "string" },
            "default": ["from_call"],
            "description": "Labels for filtering"
          },
          "waiting_on": {
            "type": ["string", "null"],
            "description": "Person name if task is blocked"
          },
          "blocked_reason": {
            "type": ["string", "null"],
            "description": "Why the task is blocked"
          },
          "source_type": {
            "type": "string",
            "const": "FIREFLIES",
            "description": "Source system identifier"
          },
          "source_id": {
            "type": "string",
            "description": "Fireflies transcript ID"
          },
          "transcript_id": {
            "type": "string",
            "description": "Fireflies transcript ID"
          },
          "source_url": {
            "type": ["string", "null"],
            "format": "uri",
            "description": "URL to source transcript"
          }
        }
      }
    },
    "client_tasks": {
      "type": "array",
      "description": "Tasks assigned to client team members",
      "items": {
        "type": "object",
        "required": ["idempotency_key", "title", "assigned_to"],
        "properties": {
          "idempotency_key": {
            "type": "string",
            "pattern": "^.+_client_\\d+$",
            "description": "Unique key: {fireflies_id}_client_{index}"
          },
          "title": {
            "type": "string",
            "minLength": 5,
            "maxLength": 200,
            "description": "What the client needs to do"
          },
          "description": {
            "type": ["string", "null"],
            "description": "Context from the call"
          },
          "assigned_to": {
            "type": "string",
            "description": "Person name on client side"
          },
          "priority": {
            "type": "string",
            "enum": ["P0", "P1", "P2", "P3"],
            "default": "P2",
            "description": "Task priority level"
          },
          "due_date": {
            "type": ["string", "null"],
            "format": "date",
            "description": "Due date in YYYY-MM-DD format"
          },
          "tags": {
            "type": "array",
            "items": { "type": "string" },
            "default": ["client_action"],
            "description": "Tags for categorization"
          },
          "labels": {
            "type": "array",
            "items": { "type": "string" },
            "default": ["from_call", "client_followup"],
            "description": "Labels for filtering"
          }
        }
      }
    }
  }
}
